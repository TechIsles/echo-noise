<!-- 在body结束标签前的脚本部分 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script type="text/javascript" src="./assets/js/marked.umd.min.js"></script>
    <script type="text/javascript" src="./assets/js/view-image.min.js"></script>
    <!-- ... 其他脚本 ... -->

    <script>
        window.note = {
            host: 'https://note.noisework.cn',
            limit: '10',
            domId: '#note-container',
            commentServer: 'https://ment.noisework.cn',
            sourceName: '「说说笔记」',
            loadingTimeout: 10000
        };

        // 初始化说说页面
        function initNotePage() {
            const noteContainer = document.querySelector(window.note.domId);
            if (!noteContainer) return;

            // 显示加载状态
            noteContainer.innerHTML = '<div class="loading-wrapper">加载中...</div>';

            // 确保必要的依赖已加载
            if (typeof marked === 'undefined') {
                console.error('marked 库未加载');
                noteContainer.innerHTML = '<div class="error-wrapper">加载失败，请刷新重试</div>';
                return;
            }

            // 配置 marked
            marked.setOptions({
                breaks: true,
                gfm: true
            });

            // 加载说说内容
            fetch(`${window.note.host}/api/notes/all`)
                .then(response => response.json())
                .then(data => {
                    if (!data || data.length === 0) {
                        noteContainer.innerHTML = '<div class="empty-wrapper">暂无内容</div>';
                        return;
                    }
                    // 处理数据并显示
                    const notesHtml = data.map(note => `
                        <div class="note-item">
                            <div class="note-content">${marked(note.content)}</div>
                            <div class="note-meta">
                                <span class="note-time">${moment(note.created).format('YYYY-MM-DD HH:mm:ss')}</span>
                            </div>
                        </div>
                    `).join('');
                    noteContainer.innerHTML = notesHtml;
                })
                .catch(error => {
                    console.error('加载说说失败:', error);
                    noteContainer.innerHTML = '<div class="error-wrapper">加载失败，请刷新重试</div>';
                });
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化说说页面
            initNotePage();
            
            // 显示说说页面
            showPage('note');
        });

        // 添加加载超时处理
        setTimeout(() => {
            const loadingWrapper = document.querySelector('.loading-wrapper');
            if (loadingWrapper && loadingWrapper.style.display !== 'none') {
                loadingWrapper.textContent = '加载失败，请刷新重试';
            }
        }, window.note.loadingTimeout);
    </script>